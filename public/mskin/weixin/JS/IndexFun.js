$(function(){var a=function(){var c="_downApp";var p=$.cookie(c);if(p==null||p==""){$("#divDownApp").show().find("a.close-icon").click(function(){$(this).parent().parent().hide();$.cookie(c,"1",{expires:7,path:"/"})})}var l=new Object();var n=function(){var A=$("#sliderBox");var B=$.cookie("_indexads");if(B!=null&&typeof(B)!="undefined"){var z=$(B);z.addClass("slides");A.empty().append(z).flexslider()}else{GetJPData("http://poster.1yyg.com","getbysortid","ID=15",function(H){if(H.state==0){var G=H.listItems;var F="<ul>";var D="";for(var E=0;E<G.length;E++){D=G[E].url;if(D.indexOf("?")>-1){D+="&pf=weixin"}else{D+="?pf=weixin"}F+='<li style="background-color:'+G[E].alt+';"><a href="'+D.replace("m.1yyg.com","weixin.1yyg.com")+'"><img src="'+G[E].src+'" alt="" /></a></li>'}F+="</ul>";var C=$(F);C.addClass("slides");A.empty().append(C).flexslider();$.cookie("_indexads",F,{domain:"1yyg.com",path:"/"})}})}};Base.getScript(Gobal.Skin+"/JS/Flexslider.js?v=151105",n);var f=function(z){$.PageDialog('<div class="Prompt">'+z+"</div>",{W:150,H:45,close:false,autoClose:true,submit:function(){location.reload()}})};var y=function(z){$.PageDialog.fail(z)};var g=function(z){$.PageDialog.ok(z)};var k=function(G,A,B,z,I){var C=255;var F=126;if(typeof(z)!="undefined"){C=z}if(typeof(z)!="undefined"){F=I}var H=null;var J='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+G+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">确定</a></div></div></div>';var E=function(){var K=$("#pageDialog");K.find("a.z-DefineBtn").click(function(){if(typeof(A)!="undefined"&&A!=null){A()}D.close()});K.find("a.z-CloseBtn").click(function(){if(typeof(B)!="undefined"&&B!=null){B()}D.cancel()})};var D=new $.PageDialog(J,{W:C,H:F,close:true,autoClose:false,ready:E})};var u=$("#goodsNav");var b=u.offset().top;var v=b+u.height();var j=false;var q=null;var m=function(){var z=$(document).scrollTop();if(z>=v){if(j){return}j=true;if(q==null){q=$('<nav class="nav-wrapper"></nav>');q.append(u.children().clone());u.parent().append(q)}else{q.show()}u.parent().addClass("nav-wrapper");u.addClass("top-fixed")}else{j=false;if(q!=null){q.hide()}u.parent().removeClass("nav-wrapper");u.removeClass("top-fixed")}};$(window).scroll(function(){m()});$("#ulOrder li").each(function(){$(this).click(function(){t();$(this).addClass("current").siblings().removeClass("current");h.orderFlag=parseInt($(this).attr("order"));i.initPage();if(h.orderFlag==30){$(this).attr("order","31")}else{if(h.orderFlag==31){$(this).attr("order","30")}}})});var t=function(){$("body").attr("style","");x.removeClass("current").next("div.select-total").hide();r=false};var r=false;var x=$("#divSort");x.click(function(z){stopBubble(z);if(r){t()}else{$("body").attr("style","overflow:hidden;");x.addClass("current").next("div.select-total").show();r=true}});x.next("div.select-total").find("li").each(function(){$(this).click(function(){h.sortID=parseInt($(this).attr("sortID"));location.href="http://weixin.1yyg.com/list/m1.do?order="+h.orderFlag+"&sort="+h.sortID})});$("body").click(function(){t()});var i=null;var w=60;var d=0;var h={sortID:0,orderFlag:10,FIdx:1,EIdx:w,isCount:1};var o=$("#ulGoodsList");var s=$("div.loading");var e=function(){var z=function(){return"sortID="+h.sortID+"&orderFlag="+h.orderFlag+"&FIdx="+h.FIdx+"&EIdx="+h.EIdx+"&isCount="+h.isCount};var A=function(F,E,D,C){F.addClass("add");GetJPData("http://weixin.1yyg.com","addShopCart","codeid="+E+"&shopNum="+D,function(L){if(L.code==0){if(typeof(C)=="function"){C()}else{g("添加成功")}addNumToCartFun(L.num)}else{if(L.code==1){var J=F.parent().parent();var H=L.NewCodeInfo;if(H!=""){var M=H.split("|");if(M!=null&&M.length==6){var I=function(){J.find("a.buy-btn").attr("codeid",M[0]);J.find("div.gRate").attr("codeid",M[0]);J.find("p.g-name").find("em").html(M[1]);J.find("ins.gray9").html("价值：￥"+CastMoney(M[3]));J.find("span.pgbar").attr("style","width:"+M[5]+"%")};var G=function(){I();A(F,M[0],D,C)};var K=function(){I()};k("本云已满员，是否云购下一云？",G,K)}}else{y("本商品已结束");J.find("span.pgbar").attr("style","width:100%")}}else{if(L.code==4){y("您参与人次已达上限！")}else{y("添加失败，请重试")}}}F.removeClass("add")})};var B=function(){GetJPData("http://weixin.1yyg.com","getGoodsPageList",z(),function(H){if(H.code==0){var F=H.listItems;if(h.isCount==1){d=H.count;h.isCount=0}var I=F.length;var J=0;var L=0;var C=0;var M=0;var D="";for(var G=0;G<I;G++){var E=F[G];J=parseInt(E.codeSales);L=parseInt(E.codeQuantity);C=parseInt(L-J);M=parseInt(J*100)/L;M=J>0&&M<1?1:M;D='<li id="'+E.goodsID+'"><a href="javascript:;" class="g-pic"><img src="'+Gobal.LoadPic+'" src2="http://mimg.1yyg.com/GoodsPic/pic-200-200/'+E.goodsPic+'" width="136" height="136" />'+(E.goodsTag==10?'<div class="pTitle pPurchase">限购</div>':"")+'</a><p class="g-name">(第<em>'+E.codePeriod+"</em>云)"+E.goodsSName+'</p><ins class="gray9">价值：￥'+CastMoney(E.codePrice)+'</ins><div class="Progress-bar"><p class="u-progress"><span class="pgbar" style="width: '+M+'%;"><span class="pging"></span></span></p></div><div class="btn-wrap"><a href="javascript:;" class="buy-btn'+(C==0?" unAdd":"")+'" codeid="'+E.codeID+'">立即1元云购</a><div class="gRate'+(C==0?" unAdd":"")+'" codeid="'+E.codeID+'"><a href="javascript:;"><s></s></a></div></div></li>';var K=$(D);K.click(function(){location.href="/products/"+$(this).attr("id")+".do"}).find("div.gRate").click(function(O){stopBubble(O);var N=$(this);if(!N.hasClass("unAdd")){A(N,N.attr("codeid"),1)}});K.find("a.buy-btn").click(function(O){stopBubble(O);var N=$(this);if(!N.hasClass("unAdd")){A(N,N.attr("codeid"),1,function(){location.href="/mycart/index.do"})}});o.append(K)}if(h.EIdx<d){_IsLoading=false}else{_IsLoading=true;s.hide()}loadImgFun(0)}else{s.hide();if(h.FIdx==1){_IsLoading=true;o.append(Gobal.NoneHtml)}}})};this.getNextPage=function(){h.FIdx=h.FIdx+w;h.EIdx=h.EIdx+w;B()};this.initPage=function(){h.FIdx=1;h.EIdx=w;h.isCount=1;o.empty();B()}};i=new e();i.initPage();scrollForLoadData(i.getNextPage)};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=151104",a)});